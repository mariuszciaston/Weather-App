(()=>{"use strict";var t=function(t,e,n,i){return new(n||(n=Promise))((function(a,r){function o(t){try{s(i.next(t))}catch(t){r(t)}}function c(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((i=i.apply(t,e||[])).next())}))};class e{static getDegreeUnit(t){return"imperial"===t?"°F":"°C"}static convertWindSpeed(t,e){const n=Math.round(3.6*e);return"imperial"===t?`${Math.round(e)} mph`:`${n} km/h`}static getDayOfWeek(t){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][new Date(1e3*t).getDay()]}static extractWeatherData(t,e){const{name:n,sys:{country:i},weather:[{main:a,description:r,icon:o}],wind:{speed:c},main:{temp:s,feels_like:d,pressure:u,humidity:l},coord:{lat:h,lon:p}}=t,m=this.getDegreeUnit(e);return{city:n,country:i,icon:o,temperature:`${Math.round(s)}${m}`,feelsLikeTemp:`${Math.round(d)}${m}`,humidityPercent:`${l}%`,windSpeedUnit:this.convertWindSpeed(e,c),pressureUnit:`${u} hPa`,description:r,weather:a,lat:h,lon:p}}static extractNextDays(t,e){const n=[],i=new Date;i.setDate(i.getDate()+1);for(let a=0;a<3;a+=1){const a=`${i.toISOString().split("T")[0]} 12:00:00`,r=t.list.find((t=>t.dt_txt===a));r&&n.push({day:this.getDayOfWeek(r.dt),temp:Math.round(r.main.temp)+this.getDegreeUnit(e),icon:r.weather[0].icon,description:r.weather[0].description}),i.setDate(i.getDate()+1)}return n}static getCurrentPosition(n){return t(this,void 0,void 0,(function*(){try{const t=yield new Promise(((t,e)=>{navigator.geolocation.getCurrentPosition(t,e)})),{latitude:i,longitude:a}=t.coords;return yield e.grabDataByPosition(n,i,a)}catch(t){return alert(t),null}}))}static grabDataByPosition(e,n,i){return t(this,void 0,void 0,(function*(){const t=`https://api.openweathermap.org/geo/1.0/reverse?lat=${n}&lon=${i}&limit=1&appid=2871c88944b81fbab922d47012695ba3`;try{const n=yield fetch(t,{mode:"cors"});if(!n.ok)throw new Error("Localization not found");const i=(yield n.json())[0].name;return this.grabDataByCity(e,i)}catch(t){return alert(t),null}}))}static grabDataByCity(e,n){return t(this,void 0,void 0,(function*(){const i=`https://api.openweathermap.org/data/2.5/weather?q=${n}&units=${e}&appid=2871c88944b81fbab922d47012695ba3`;try{const a=yield new Promise(((e,n)=>t(this,void 0,void 0,(function*(){setTimeout((()=>t(this,void 0,void 0,(function*(){try{const t=yield fetch(i,{mode:"cors"});e(t)}catch(t){n(t)}}))),750)}))));if(!a.ok)throw new Error(`City '${n}' not found`);const r=this.extractWeatherData(yield a.json(),e),o=yield this.grabDataNextDays(e,r.lat,r.lon);return r.nextDays=o,r}catch(t){return alert(t),null}}))}static grabDataNextDays(e,n,i){return t(this,void 0,void 0,(function*(){const t=`https://api.openweathermap.org/data/2.5/forecast?lat=${n}&lon=${i}&units=${e}&appid=2871c88944b81fbab922d47012695ba3`;try{const n=yield fetch(t,{mode:"cors"});if(!n.ok)throw new Error("Localization not found");const i=yield n.json();return this.extractNextDays(i,e)}catch(t){return alert(t),null}}))}}var n=function(t,e,n,i){return new(n||(n=Promise))((function(a,r){function o(t){try{s(i.next(t))}catch(t){r(t)}}function c(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((i=i.apply(t,e||[])).next())}))};class i{static setUnit(t){const e=document.querySelector("#change-units"),n=e.dataset.unit||t||"metric";return this.updateUnitBtn(e,n),n}static updateUnitBtn(t,e){const n=document.querySelector("#change-units span#C"),i=document.querySelector("#change-units span#F");t.dataset.unit=e,n.classList.toggle("bold","metric"===e),i.classList.toggle("bold","imperial"===e)}static toggleUnit(t){const e="metric"===t.dataset.unit?"imperial":"metric";this.updateUnitBtn(t,e),this.replaceUnits(e)}static convertTemperature(t,e){let n=parseFloat(t);return"imperial"===e&&t.includes("°C")?(n=Math.round(9*n/5+32),`${n}°F`):"metric"===e&&t.includes("°F")?(n=Math.round(5*(n-32)/9),`${n}°C`):t}static convertWindSpeed(t,e){let n=parseFloat(t);return"imperial"===e&&t.includes("km/h")?(n=Math.round(n/1.6093),`${n} mph`):"metric"===e&&t.includes("mph")?(n=Math.round(1.6093*n),`${n} km/h`):t}static replaceUnits(t){["#temperature","#feels-like","#wind-speed","#tommorow-card .temp","#after-tommorow-card .temp","#next-card .temp"].forEach((e=>{const n=document.querySelector(e),i=n.textContent,a="#wind-speed"===e;n.textContent=a?this.convertWindSpeed(i,t):this.convertTemperature(i,t)}))}static loading(t){const e=document.querySelector("#loading-spinner");document.querySelector("#weather-container").classList.toggle("hide",t),e.classList.toggle("hide",!t)}static updateUI(t){this.loading(!1),this.clearWeather(),this.displayWeather(t),this.setBcgColor(t)}static pickCity(t){this.loading(!0),t.target.classList.contains("btn")&&e.grabDataByCity(this.setUnit(),t.target.textContent).then((t=>{this.updateUI(t)}))}static searchCity(){const t=document.querySelector("#search-input");t.value=t.value.trim(),""!==t.value&&(this.loading(!0),e.grabDataByCity(this.setUnit(),t.value).then((e=>{t.value="",this.updateUI(e)})).catch((()=>{this.setGreyColor()})))}static findMe(){return n(this,void 0,void 0,(function*(){this.loading(!0);const t=yield e.getCurrentPosition(this.setUnit());t&&this.updateUI(t)}))}static clearWeather(){["main-card","img-card","secondary-card","tommorow-card","after-tommorow-card","next-card"].forEach((t=>{document.querySelector(`#${t}`).textContent=""}))}static displayMainCard(t){const e=document.querySelector("#main-card");["city","temperature","description"].forEach((n=>{if(n in t){const i=document.createElement("h1");i.setAttribute("id","city"===n?"city-country":n),i.textContent=t[n],e.appendChild(i)}})),t.country&&(document.querySelector("#city-country").textContent+=`, ${t.country}`)}static displayImgCard(t){const e=document.querySelector("#img-card"),n=document.createElement("img");n.src=`https://openweathermap.org/img/wn/${t.icon}@4x.png`,n.alt=t.description,e.appendChild(n)}static displaySecondaryCard(t){const e=document.querySelector("#secondary-card"),n=["Feels like: ","Humidity: ","Wind speed: ","Pressure: "],i=[t.feelsLikeTemp,t.humidityPercent,t.windSpeedUnit,t.pressureUnit];["feels-like","humidity","wind-speed","pressure"].forEach(((t,a)=>{const r=document.createElement("p");r.textContent=n[a];const o=document.createElement("span");o.id=t,o.append(` ${i[a]}`),r.appendChild(o),e.appendChild(r)}))}static createElementWithClass(t,e){const n=document.createElement(t);return n.className=e,n}static displayCard(t,e,n){const i=document.querySelector(`#${n}`),a=this.createElementWithClass("p","day"),r=this.createElementWithClass("p","temp"),o=this.createElementWithClass("img","icon");a.textContent=` ${t.nextDays[e].day}`,r.textContent=` ${t.nextDays[e].temp}`,o.src=`https://openweathermap.org/img/wn/${t.nextDays[e].icon}@4x.png`,o.alt=t.nextDays[e].description,i.append(a,r,o)}static displayWeather(t){this.displayMainCard(t),this.displayImgCard(t),this.displaySecondaryCard(t),["tommorow-card","after-tommorow-card","next-card"].forEach(((e,n)=>{this.displayCard(t,n,e)}))}static setBcgColor(t){let e,n=t.temperature;if(n.includes("°F")){const t="metric";n=this.convertTemperature(n,t)}e=parseInt(n,10);e=e>30?30:e,e=e<0?0:e;const i=`hsl(${360-(-7.333333333333333*(30-e)- -360)}, 100%, 75%)`;document.documentElement.style.backgroundColor=i}static setGreyColor(){document.documentElement.style.backgroundColor="hsl(0, 0%, 75%)"}static attachListeners(){const t=document.querySelector("#sample-locations"),e=document.querySelector("#change-units"),n=document.querySelector("#search-box"),i=document.querySelector("#search-btn"),a=document.querySelector("#find-btn");t.addEventListener("click",(t=>this.pickCity(t))),n.addEventListener("submit",(t=>t.preventDefault())),i.addEventListener("click",(()=>this.searchCity())),a.addEventListener("click",(()=>this.findMe())),e.addEventListener("click",(()=>this.toggleUnit(e)))}static runApp(){this.setUnit(),this.attachListeners()}}document.addEventListener("DOMContentLoaded",(()=>i.runApp()))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Iiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2VhdGhlci1hcHAvLi9zcmMvY29kZS9sb2dpYy50cyIsIndlYnBhY2s6Ly93ZWF0aGVyLWFwcC8uL3NyYy9jb2RlL3VpLnRzIiwid2VicGFjazovL3dlYXRoZXItYXBwLy4vc3JjL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTG9naWMge1xuICAgIHN0YXRpYyBnZXREZWdyZWVVbml0KHN5c3RlbSkge1xuICAgICAgICByZXR1cm4gc3lzdGVtID09PSAnaW1wZXJpYWwnID8gJ8KwRicgOiAnwrBDJztcbiAgICB9XG4gICAgc3RhdGljIGNvbnZlcnRXaW5kU3BlZWQoc3lzdGVtLCB3aW5kU3BlZWQpIHtcbiAgICAgICAgY29uc3Qgd2luZFNwZWVkSW5LbUggPSBNYXRoLnJvdW5kKHdpbmRTcGVlZCAqIDMuNik7XG4gICAgICAgIHJldHVybiBzeXN0ZW0gPT09ICdpbXBlcmlhbCcgPyBgJHtNYXRoLnJvdW5kKHdpbmRTcGVlZCl9IG1waGAgOiBgJHt3aW5kU3BlZWRJbkttSH0ga20vaGA7XG4gICAgfVxuICAgIHN0YXRpYyBnZXREYXlPZldlZWsoZXBvY2gpIHtcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKGVwb2NoICogMTAwMCk7XG4gICAgICAgIGNvbnN0IGRheXMgPSBbJ1N1bmRheScsICdNb25kYXknLCAnVHVlc2RheScsICdXZWRuZXNkYXknLCAnVGh1cnNkYXknLCAnRnJpZGF5JywgJ1NhdHVyZGF5J107XG4gICAgICAgIHJldHVybiBkYXlzW2RhdGUuZ2V0RGF5KCldO1xuICAgIH1cbiAgICBzdGF0aWMgZXh0cmFjdFdlYXRoZXJEYXRhKGRhdGEsIHN5c3RlbSkge1xuICAgICAgICBjb25zdCB7IG5hbWU6IGNpdHksIHN5czogeyBjb3VudHJ5IH0sIHdlYXRoZXI6IFt7IG1haW46IHdlYXRoZXIsIGRlc2NyaXB0aW9uLCBpY29uIH1dLCB3aW5kOiB7IHNwZWVkOiB3aW5kU3BlZWQgfSwgbWFpbjogeyB0ZW1wLCBmZWVsc19saWtlOiBmZWVsc0xpa2UsIHByZXNzdXJlLCBodW1pZGl0eSB9LCBjb29yZDogeyBsYXQsIGxvbiB9LCB9ID0gZGF0YTtcbiAgICAgICAgY29uc3QgZGVncmVlVW5pdCA9IHRoaXMuZ2V0RGVncmVlVW5pdChzeXN0ZW0pO1xuICAgICAgICBjb25zdCB0ZW1wZXJhdHVyZSA9IGAke01hdGgucm91bmQodGVtcCl9JHtkZWdyZWVVbml0fWA7XG4gICAgICAgIGNvbnN0IGZlZWxzTGlrZVRlbXAgPSBgJHtNYXRoLnJvdW5kKGZlZWxzTGlrZSl9JHtkZWdyZWVVbml0fWA7XG4gICAgICAgIGNvbnN0IHdpbmRTcGVlZFVuaXQgPSB0aGlzLmNvbnZlcnRXaW5kU3BlZWQoc3lzdGVtLCB3aW5kU3BlZWQpO1xuICAgICAgICBjb25zdCBwcmVzc3VyZVVuaXQgPSBgJHtwcmVzc3VyZX0gaFBhYDtcbiAgICAgICAgY29uc3QgaHVtaWRpdHlQZXJjZW50ID0gYCR7aHVtaWRpdHl9JWA7XG4gICAgICAgIHJldHVybiB7IGNpdHksIGNvdW50cnksIGljb24sIHRlbXBlcmF0dXJlLCBmZWVsc0xpa2VUZW1wLCBodW1pZGl0eVBlcmNlbnQsIHdpbmRTcGVlZFVuaXQsIHByZXNzdXJlVW5pdCwgZGVzY3JpcHRpb24sIHdlYXRoZXIsIGxhdCwgbG9uIH07XG4gICAgfVxuICAgIHN0YXRpYyBleHRyYWN0TmV4dERheXMobmV4dERhdGEsIHN5c3RlbSkge1xuICAgICAgICBjb25zdCBuZXh0RGF5cyA9IFtdO1xuICAgICAgICBjb25zdCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGN1cnJlbnREYXRlLnNldERhdGUoY3VycmVudERhdGUuZ2V0RGF0ZSgpICsgMSk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMzsgaSArPSAxKSB7XG4gICAgICAgICAgICBjb25zdCBkYXRlU3RyID0gY3VycmVudERhdGUudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdO1xuICAgICAgICAgICAgY29uc3QgZGF0ZVRpbWVTdHIgPSBgJHtkYXRlU3RyfSAxMjowMDowMGA7XG4gICAgICAgICAgICBjb25zdCBkYXlEYXRhID0gbmV4dERhdGEubGlzdC5maW5kKChpdGVtKSA9PiBpdGVtLmR0X3R4dCA9PT0gZGF0ZVRpbWVTdHIpO1xuICAgICAgICAgICAgaWYgKGRheURhdGEpIHtcbiAgICAgICAgICAgICAgICBuZXh0RGF5cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgZGF5OiB0aGlzLmdldERheU9mV2VlayhkYXlEYXRhLmR0KSxcbiAgICAgICAgICAgICAgICAgICAgdGVtcDogTWF0aC5yb3VuZChkYXlEYXRhLm1haW4udGVtcCkgKyB0aGlzLmdldERlZ3JlZVVuaXQoc3lzdGVtKSxcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogZGF5RGF0YS53ZWF0aGVyWzBdLmljb24sXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBkYXlEYXRhLndlYXRoZXJbMF0uZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdXJyZW50RGF0ZS5zZXREYXRlKGN1cnJlbnREYXRlLmdldERhdGUoKSArIDEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXh0RGF5cztcbiAgICB9XG4gICAgc3RhdGljIGdldEN1cnJlbnRQb3NpdGlvbihzeXN0ZW0pIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSB5aWVsZCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIG5hdmlnYXRvci5nZW9sb2NhdGlvbi5nZXRDdXJyZW50UG9zaXRpb24ocmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb25zdCB7IGxhdGl0dWRlLCBsb25naXR1ZGUgfSA9IHBvc2l0aW9uLmNvb3JkcztcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0geWllbGQgTG9naWMuZ3JhYkRhdGFCeVBvc2l0aW9uKHN5c3RlbSwgbGF0aXR1ZGUsIGxvbmdpdHVkZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBhbGVydChlcnJvcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzdGF0aWMgZ3JhYkRhdGFCeVBvc2l0aW9uKHN5c3RlbSwgbGF0LCBsb24pIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IGFwaSA9IGBodHRwczovL2FwaS5vcGVud2VhdGhlcm1hcC5vcmcvZ2VvLzEuMC9yZXZlcnNlP2xhdD0ke2xhdH0mbG9uPSR7bG9ufSZsaW1pdD0xJmFwcGlkPTI4NzFjODg5NDRiODFmYmFiOTIyZDQ3MDEyNjk1YmEzYDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBmZXRjaChhcGksIHsgbW9kZTogJ2NvcnMnIH0pO1xuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTG9jYWxpemF0aW9uIG5vdCBmb3VuZGApO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNpdHkgPSAoeWllbGQgcmVzcG9uc2UuanNvbigpKVswXS5uYW1lO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdyYWJEYXRhQnlDaXR5KHN5c3RlbSwgY2l0eSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBhbGVydChlcnJvcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzdGF0aWMgZ3JhYkRhdGFCeUNpdHkoc3lzdGVtLCBjaXR5KSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBhcGkgPSBgaHR0cHM6Ly9hcGkub3BlbndlYXRoZXJtYXAub3JnL2RhdGEvMi41L3dlYXRoZXI/cT0ke2NpdHl9JnVuaXRzPSR7c3lzdGVtfSZhcHBpZD0yODcxYzg4OTQ0YjgxZmJhYjkyMmQ0NzAxMjY5NWJhM2A7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzID0geWllbGQgZmV0Y2goYXBpLCB7IG1vZGU6ICdjb3JzJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KSwgNzUwKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaylcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDaXR5ICcke2NpdHl9JyBub3QgZm91bmRgKTtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5leHRyYWN0V2VhdGhlckRhdGEoeWllbGQgcmVzcG9uc2UuanNvbigpLCBzeXN0ZW0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5leHREYXlzID0geWllbGQgdGhpcy5ncmFiRGF0YU5leHREYXlzKHN5c3RlbSwgZGF0YS5sYXQsIGRhdGEubG9uKTtcbiAgICAgICAgICAgICAgICBkYXRhLm5leHREYXlzID0gbmV4dERheXM7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBhbGVydChlcnJvcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzdGF0aWMgZ3JhYkRhdGFOZXh0RGF5cyhzeXN0ZW0sIGxhdCwgbG9uKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBhcGkgPSBgaHR0cHM6Ly9hcGkub3BlbndlYXRoZXJtYXAub3JnL2RhdGEvMi41L2ZvcmVjYXN0P2xhdD0ke2xhdH0mbG9uPSR7bG9ufSZ1bml0cz0ke3N5c3RlbX0mYXBwaWQ9Mjg3MWM4ODk0NGI4MWZiYWI5MjJkNDcwMTI2OTViYTNgO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGZldGNoKGFwaSwgeyBtb2RlOiAnY29ycycgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaylcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBMb2NhbGl6YXRpb24gbm90IGZvdW5kYCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV4dERhdGEgPSB5aWVsZCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV4dERheXMgPSB0aGlzLmV4dHJhY3ROZXh0RGF5cyhuZXh0RGF0YSwgc3lzdGVtKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV4dERheXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBhbGVydChlcnJvcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiIsInZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuaW1wb3J0IExvZ2ljIGZyb20gJy4vbG9naWMnO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVUkge1xuICAgIHN0YXRpYyBzZXRVbml0KHN5c3RlbSkge1xuICAgICAgICBjb25zdCB1bml0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NoYW5nZS11bml0cycpO1xuICAgICAgICBjb25zdCBzeXN0ZW1Vbml0cyA9IHVuaXRCdG4uZGF0YXNldC51bml0IHx8IHN5c3RlbSB8fCAnbWV0cmljJztcbiAgICAgICAgdGhpcy51cGRhdGVVbml0QnRuKHVuaXRCdG4sIHN5c3RlbVVuaXRzKTtcbiAgICAgICAgcmV0dXJuIHN5c3RlbVVuaXRzO1xuICAgIH1cbiAgICBzdGF0aWMgdXBkYXRlVW5pdEJ0bih1bml0QnRuLCBzeXN0ZW1Vbml0cykge1xuICAgICAgICBjb25zdCBzcGFuQyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjaGFuZ2UtdW5pdHMgc3BhbiNDJyk7XG4gICAgICAgIGNvbnN0IHNwYW5GID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NoYW5nZS11bml0cyBzcGFuI0YnKTtcbiAgICAgICAgdW5pdEJ0bi5kYXRhc2V0LnVuaXQgPSBzeXN0ZW1Vbml0cztcbiAgICAgICAgc3BhbkMuY2xhc3NMaXN0LnRvZ2dsZSgnYm9sZCcsIHN5c3RlbVVuaXRzID09PSAnbWV0cmljJyk7XG4gICAgICAgIHNwYW5GLmNsYXNzTGlzdC50b2dnbGUoJ2JvbGQnLCBzeXN0ZW1Vbml0cyA9PT0gJ2ltcGVyaWFsJyk7XG4gICAgfVxuICAgIHN0YXRpYyB0b2dnbGVVbml0KHVuaXRCdG4pIHtcbiAgICAgICAgY29uc3Qgc3lzdGVtVW5pdHMgPSB1bml0QnRuLmRhdGFzZXQudW5pdCA9PT0gJ21ldHJpYycgPyAnaW1wZXJpYWwnIDogJ21ldHJpYyc7XG4gICAgICAgIHRoaXMudXBkYXRlVW5pdEJ0bih1bml0QnRuLCBzeXN0ZW1Vbml0cyk7XG4gICAgICAgIHRoaXMucmVwbGFjZVVuaXRzKHN5c3RlbVVuaXRzKTtcbiAgICB9XG4gICAgc3RhdGljIGNvbnZlcnRUZW1wZXJhdHVyZSh0ZW1wLCBzeXN0ZW1Vbml0cykge1xuICAgICAgICBsZXQgdGVtcE51bWJlciA9IHBhcnNlRmxvYXQodGVtcCk7XG4gICAgICAgIGlmIChzeXN0ZW1Vbml0cyA9PT0gJ2ltcGVyaWFsJyAmJiB0ZW1wLmluY2x1ZGVzKCfCsEMnKSkge1xuICAgICAgICAgICAgdGVtcE51bWJlciA9IE1hdGgucm91bmQoKHRlbXBOdW1iZXIgKiA5KSAvIDUgKyAzMik7XG4gICAgICAgICAgICByZXR1cm4gYCR7dGVtcE51bWJlcn3CsEZgO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzeXN0ZW1Vbml0cyA9PT0gJ21ldHJpYycgJiYgdGVtcC5pbmNsdWRlcygnwrBGJykpIHtcbiAgICAgICAgICAgIHRlbXBOdW1iZXIgPSBNYXRoLnJvdW5kKCgodGVtcE51bWJlciAtIDMyKSAqIDUpIC8gOSk7XG4gICAgICAgICAgICByZXR1cm4gYCR7dGVtcE51bWJlcn3CsENgO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0ZW1wO1xuICAgIH1cbiAgICBzdGF0aWMgY29udmVydFdpbmRTcGVlZChzcGVlZCwgc3lzdGVtVW5pdHMpIHtcbiAgICAgICAgbGV0IHNwZWVkTnVtYmVyID0gcGFyc2VGbG9hdChzcGVlZCk7XG4gICAgICAgIGlmIChzeXN0ZW1Vbml0cyA9PT0gJ2ltcGVyaWFsJyAmJiBzcGVlZC5pbmNsdWRlcygna20vaCcpKSB7XG4gICAgICAgICAgICBzcGVlZE51bWJlciA9IE1hdGgucm91bmQoc3BlZWROdW1iZXIgLyAxLjYwOTMpO1xuICAgICAgICAgICAgcmV0dXJuIGAke3NwZWVkTnVtYmVyfSBtcGhgO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzeXN0ZW1Vbml0cyA9PT0gJ21ldHJpYycgJiYgc3BlZWQuaW5jbHVkZXMoJ21waCcpKSB7XG4gICAgICAgICAgICBzcGVlZE51bWJlciA9IE1hdGgucm91bmQoc3BlZWROdW1iZXIgKiAxLjYwOTMpO1xuICAgICAgICAgICAgcmV0dXJuIGAke3NwZWVkTnVtYmVyfSBrbS9oYDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3BlZWQ7XG4gICAgfVxuICAgIHN0YXRpYyByZXBsYWNlVW5pdHMoc3lzdGVtVW5pdHMpIHtcbiAgICAgICAgY29uc3QgZWxlbWVudHMgPSBbJyN0ZW1wZXJhdHVyZScsICcjZmVlbHMtbGlrZScsICcjd2luZC1zcGVlZCcsICcjdG9tbW9yb3ctY2FyZCAudGVtcCcsICcjYWZ0ZXItdG9tbW9yb3ctY2FyZCAudGVtcCcsICcjbmV4dC1jYXJkIC50ZW1wJ107XG4gICAgICAgIGVsZW1lbnRzLmZvckVhY2goKHNlbGVjdG9yKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGVsZW1lbnQudGV4dENvbnRlbnQ7XG4gICAgICAgICAgICBjb25zdCBpc1dpbmRTcGVlZCA9IHNlbGVjdG9yID09PSAnI3dpbmQtc3BlZWQnO1xuICAgICAgICAgICAgZWxlbWVudC50ZXh0Q29udGVudCA9IGlzV2luZFNwZWVkID8gdGhpcy5jb252ZXJ0V2luZFNwZWVkKHZhbHVlLCBzeXN0ZW1Vbml0cykgOiB0aGlzLmNvbnZlcnRUZW1wZXJhdHVyZSh2YWx1ZSwgc3lzdGVtVW5pdHMpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgc3RhdGljIGxvYWRpbmcodG9nZ2xlKSB7XG4gICAgICAgIGNvbnN0IHNwaW5uZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbG9hZGluZy1zcGlubmVyJyk7XG4gICAgICAgIGNvbnN0IHdlYXRoZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjd2VhdGhlci1jb250YWluZXInKTtcbiAgICAgICAgd2VhdGhlci5jbGFzc0xpc3QudG9nZ2xlKCdoaWRlJywgdG9nZ2xlKTtcbiAgICAgICAgc3Bpbm5lci5jbGFzc0xpc3QudG9nZ2xlKCdoaWRlJywgIXRvZ2dsZSk7XG4gICAgfVxuICAgIHN0YXRpYyB1cGRhdGVVSShkYXRhKSB7XG4gICAgICAgIHRoaXMubG9hZGluZyhmYWxzZSk7XG4gICAgICAgIHRoaXMuY2xlYXJXZWF0aGVyKCk7XG4gICAgICAgIHRoaXMuZGlzcGxheVdlYXRoZXIoZGF0YSk7XG4gICAgICAgIHRoaXMuc2V0QmNnQ29sb3IoZGF0YSk7XG4gICAgfVxuICAgIHN0YXRpYyBwaWNrQ2l0eShlKSB7XG4gICAgICAgIHRoaXMubG9hZGluZyh0cnVlKTtcbiAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnYnRuJykpIHtcbiAgICAgICAgICAgIExvZ2ljLmdyYWJEYXRhQnlDaXR5KHRoaXMuc2V0VW5pdCgpLCBlLnRhcmdldC50ZXh0Q29udGVudCkudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlVUkoZGF0YSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzdGF0aWMgc2VhcmNoQ2l0eSgpIHtcbiAgICAgICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc2VhcmNoLWlucHV0Jyk7XG4gICAgICAgIGlucHV0LnZhbHVlID0gaW5wdXQudmFsdWUudHJpbSgpO1xuICAgICAgICBpZiAoaW5wdXQudmFsdWUgIT09ICcnKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcodHJ1ZSk7XG4gICAgICAgICAgICBMb2dpYy5ncmFiRGF0YUJ5Q2l0eSh0aGlzLnNldFVuaXQoKSwgaW5wdXQudmFsdWUpXG4gICAgICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlVUkoZGF0YSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRHcmV5Q29sb3IoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHN0YXRpYyBmaW5kTWUoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcodHJ1ZSk7XG4gICAgICAgICAgICBjb25zdCBkYXRhID0geWllbGQgTG9naWMuZ2V0Q3VycmVudFBvc2l0aW9uKHRoaXMuc2V0VW5pdCgpKTtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVVSShkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0YXRpYyBjbGVhcldlYXRoZXIoKSB7XG4gICAgICAgIGNvbnN0IGNhcmRJZHMgPSBbJ21haW4tY2FyZCcsICdpbWctY2FyZCcsICdzZWNvbmRhcnktY2FyZCcsICd0b21tb3Jvdy1jYXJkJywgJ2FmdGVyLXRvbW1vcm93LWNhcmQnLCAnbmV4dC1jYXJkJ107XG4gICAgICAgIGNhcmRJZHMuZm9yRWFjaCgoaWQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNhcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpZH1gKTtcbiAgICAgICAgICAgIGNhcmQudGV4dENvbnRlbnQgPSAnJztcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0YXRpYyBkaXNwbGF5TWFpbkNhcmQoZGF0YSkge1xuICAgICAgICBjb25zdCBtYWluQ2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtYWluLWNhcmQnKTtcbiAgICAgICAgY29uc3QgZWxlbWVudHMgPSBbJ2NpdHknLCAndGVtcGVyYXR1cmUnLCAnZGVzY3JpcHRpb24nXTtcbiAgICAgICAgZWxlbWVudHMuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKGVsZW1lbnQgaW4gZGF0YSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDEnKTtcbiAgICAgICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ2lkJywgZWxlbWVudCA9PT0gJ2NpdHknID8gJ2NpdHktY291bnRyeScgOiBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICBlbC50ZXh0Q29udGVudCA9IGRhdGFbZWxlbWVudF07XG4gICAgICAgICAgICAgICAgbWFpbkNhcmQuYXBwZW5kQ2hpbGQoZWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGRhdGEuY291bnRyeSkge1xuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NpdHktY291bnRyeScpLnRleHRDb250ZW50ICs9IGAsICR7ZGF0YS5jb3VudHJ5fWA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3RhdGljIGRpc3BsYXlJbWdDYXJkKGRhdGEpIHtcbiAgICAgICAgY29uc3QgaW1nQ2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNpbWctY2FyZCcpO1xuICAgICAgICBjb25zdCBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgICAgICAgaW1nLnNyYyA9IGBodHRwczovL29wZW53ZWF0aGVybWFwLm9yZy9pbWcvd24vJHtkYXRhLmljb259QDR4LnBuZ2A7XG4gICAgICAgIGltZy5hbHQgPSBkYXRhLmRlc2NyaXB0aW9uO1xuICAgICAgICBpbWdDYXJkLmFwcGVuZENoaWxkKGltZyk7XG4gICAgfVxuICAgIHN0YXRpYyBkaXNwbGF5U2Vjb25kYXJ5Q2FyZChkYXRhKSB7XG4gICAgICAgIGNvbnN0IHNlY29uZGFyeUNhcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc2Vjb25kYXJ5LWNhcmQnKTtcbiAgICAgICAgY29uc3QgZWxlbWVudHMgPSBbJ2ZlZWxzLWxpa2UnLCAnaHVtaWRpdHknLCAnd2luZC1zcGVlZCcsICdwcmVzc3VyZSddO1xuICAgICAgICBjb25zdCBkZXNjcmlwdGlvbnMgPSBbJ0ZlZWxzIGxpa2U6ICcsICdIdW1pZGl0eTogJywgJ1dpbmQgc3BlZWQ6ICcsICdQcmVzc3VyZTogJ107XG4gICAgICAgIGNvbnN0IGRhdGFWYWx1ZXMgPSBbZGF0YS5mZWVsc0xpa2VUZW1wLCBkYXRhLmh1bWlkaXR5UGVyY2VudCwgZGF0YS53aW5kU3BlZWRVbml0LCBkYXRhLnByZXNzdXJlVW5pdF07XG4gICAgICAgIGVsZW1lbnRzLmZvckVhY2goKGVsZW1lbnQsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgICAgICAgICAgcC50ZXh0Q29udGVudCA9IGRlc2NyaXB0aW9uc1tpbmRleF07XG4gICAgICAgICAgICBjb25zdCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICAgICAgc3Bhbi5pZCA9IGVsZW1lbnQ7XG4gICAgICAgICAgICBzcGFuLmFwcGVuZChgICR7ZGF0YVZhbHVlc1tpbmRleF19YCk7XG4gICAgICAgICAgICBwLmFwcGVuZENoaWxkKHNwYW4pO1xuICAgICAgICAgICAgc2Vjb25kYXJ5Q2FyZC5hcHBlbmRDaGlsZChwKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0YXRpYyBjcmVhdGVFbGVtZW50V2l0aENsYXNzKGVsZW1lbnRUeXBlLCBjbGFzc05hbWUpIHtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoZWxlbWVudFR5cGUpO1xuICAgICAgICBlbGVtZW50LmNsYXNzTmFtZSA9IGNsYXNzTmFtZTtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgfVxuICAgIHN0YXRpYyBkaXNwbGF5Q2FyZChkYXRhLCBkYXlJbmRleCwgY2FyZElkKSB7XG4gICAgICAgIGNvbnN0IGNhcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjJHtjYXJkSWR9YCk7XG4gICAgICAgIGNvbnN0IGRheUVsZW1lbnQgPSB0aGlzLmNyZWF0ZUVsZW1lbnRXaXRoQ2xhc3MoJ3AnLCAnZGF5Jyk7XG4gICAgICAgIGNvbnN0IHRlbXBFbGVtZW50ID0gdGhpcy5jcmVhdGVFbGVtZW50V2l0aENsYXNzKCdwJywgJ3RlbXAnKTtcbiAgICAgICAgY29uc3QgaWNvbkVsZW1lbnQgPSB0aGlzLmNyZWF0ZUVsZW1lbnRXaXRoQ2xhc3MoJ2ltZycsICdpY29uJyk7XG4gICAgICAgIGRheUVsZW1lbnQudGV4dENvbnRlbnQgPSBgICR7ZGF0YS5uZXh0RGF5c1tkYXlJbmRleF0uZGF5fWA7XG4gICAgICAgIHRlbXBFbGVtZW50LnRleHRDb250ZW50ID0gYCAke2RhdGEubmV4dERheXNbZGF5SW5kZXhdLnRlbXB9YDtcbiAgICAgICAgaWNvbkVsZW1lbnQuc3JjID0gYGh0dHBzOi8vb3BlbndlYXRoZXJtYXAub3JnL2ltZy93bi8ke2RhdGEubmV4dERheXNbZGF5SW5kZXhdLmljb259QDR4LnBuZ2A7XG4gICAgICAgIGljb25FbGVtZW50LmFsdCA9IGRhdGEubmV4dERheXNbZGF5SW5kZXhdLmRlc2NyaXB0aW9uO1xuICAgICAgICBjYXJkLmFwcGVuZChkYXlFbGVtZW50LCB0ZW1wRWxlbWVudCwgaWNvbkVsZW1lbnQpO1xuICAgIH1cbiAgICBzdGF0aWMgZGlzcGxheVdlYXRoZXIoZGF0YSkge1xuICAgICAgICB0aGlzLmRpc3BsYXlNYWluQ2FyZChkYXRhKTtcbiAgICAgICAgdGhpcy5kaXNwbGF5SW1nQ2FyZChkYXRhKTtcbiAgICAgICAgdGhpcy5kaXNwbGF5U2Vjb25kYXJ5Q2FyZChkYXRhKTtcbiAgICAgICAgWyd0b21tb3Jvdy1jYXJkJywgJ2FmdGVyLXRvbW1vcm93LWNhcmQnLCAnbmV4dC1jYXJkJ10uZm9yRWFjaCgoY2FyZElkLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kaXNwbGF5Q2FyZChkYXRhLCBpbmRleCwgY2FyZElkKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0YXRpYyBzZXRCY2dDb2xvcihkYXRhKSB7XG4gICAgICAgIGxldCB0ZW1wU3RyID0gZGF0YS50ZW1wZXJhdHVyZTtcbiAgICAgICAgbGV0IHRlbXA7XG4gICAgICAgIGlmICh0ZW1wU3RyLmluY2x1ZGVzKCfCsEYnKSkge1xuICAgICAgICAgICAgY29uc3Qgc3lzdGVtID0gJ21ldHJpYyc7XG4gICAgICAgICAgICB0ZW1wU3RyID0gdGhpcy5jb252ZXJ0VGVtcGVyYXR1cmUodGVtcFN0ciwgc3lzdGVtKTtcbiAgICAgICAgfVxuICAgICAgICB0ZW1wID0gcGFyc2VJbnQodGVtcFN0ciwgMTApO1xuICAgICAgICBjb25zdCBtaW5UZW1wID0gMDtcbiAgICAgICAgY29uc3QgbWF4VGVtcCA9IDMwO1xuICAgICAgICBjb25zdCBtaW5Ic2wgPSAyMjA7XG4gICAgICAgIGNvbnN0IG1heEhzbCA9IDA7XG4gICAgICAgIHRlbXAgPSB0ZW1wID4gbWF4VGVtcCA/IG1heFRlbXAgOiB0ZW1wO1xuICAgICAgICB0ZW1wID0gdGVtcCA8IG1pblRlbXAgPyBtaW5UZW1wIDogdGVtcDtcbiAgICAgICAgY29uc3QgcmFuZ2VUZW1wID0gbWF4VGVtcCAtIG1pblRlbXA7XG4gICAgICAgIGNvbnN0IHJhbmdlSHNsID0gbWF4SHNsIC0gbWluSHNsO1xuICAgICAgICBjb25zdCBkZWdDb3VudCA9IG1heFRlbXAgLSB0ZW1wO1xuICAgICAgICBjb25zdCBoc2xzRGVnID0gcmFuZ2VIc2wgLyByYW5nZVRlbXA7XG4gICAgICAgIGNvbnN0IHJldHVybkh1ZSA9IDM2MCAtIChkZWdDb3VudCAqIGhzbHNEZWcgLSAobWF4SHNsIC0gMzYwKSk7XG4gICAgICAgIGNvbnN0IGNvbG9yID0gYGhzbCgke3JldHVybkh1ZX0sIDEwMCUsIDc1JSlgO1xuICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3I7XG4gICAgfVxuICAgIHN0YXRpYyBzZXRHcmV5Q29sb3IoKSB7XG4gICAgICAgIGNvbnN0IGNvbG9yID0gYGhzbCgwLCAwJSwgNzUlKWA7XG4gICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvcjtcbiAgICB9XG4gICAgc3RhdGljIGF0dGFjaExpc3RlbmVycygpIHtcbiAgICAgICAgY29uc3Qgc2FtcGxlTG9jYXRpb25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3NhbXBsZS1sb2NhdGlvbnMnKTtcbiAgICAgICAgY29uc3QgdW5pdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjaGFuZ2UtdW5pdHMnKTtcbiAgICAgICAgY29uc3Qgc2VhcmNoQm94ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3NlYXJjaC1ib3gnKTtcbiAgICAgICAgY29uc3Qgc2VhcmNoQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3NlYXJjaC1idG4nKTtcbiAgICAgICAgY29uc3QgZmluZEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNmaW5kLWJ0bicpO1xuICAgICAgICBzYW1wbGVMb2NhdGlvbnMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gdGhpcy5waWNrQ2l0eShlKSk7XG4gICAgICAgIHNlYXJjaEJveC5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZSkgPT4gZS5wcmV2ZW50RGVmYXVsdCgpKTtcbiAgICAgICAgc2VhcmNoQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5zZWFyY2hDaXR5KCkpO1xuICAgICAgICBmaW5kQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5maW5kTWUoKSk7XG4gICAgICAgIHVuaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB0aGlzLnRvZ2dsZVVuaXQodW5pdEJ0bikpO1xuICAgIH1cbiAgICBzdGF0aWMgcnVuQXBwKCkge1xuICAgICAgICB0aGlzLnNldFVuaXQoKTtcbiAgICAgICAgdGhpcy5hdHRhY2hMaXN0ZW5lcnMoKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgJ25vcm1hbGl6ZS5jc3MnO1xuaW1wb3J0ICcuL3N0eWxlL3N0eWxlLmNzcyc7XG5pbXBvcnQgVUkgZnJvbSAnLi9jb2RlL3VpJztcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiBVSS5ydW5BcHAoKSk7XG4iXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIkxvZ2ljIiwiZ2V0RGVncmVlVW5pdCIsInN5c3RlbSIsImNvbnZlcnRXaW5kU3BlZWQiLCJ3aW5kU3BlZWQiLCJ3aW5kU3BlZWRJbkttSCIsIk1hdGgiLCJyb3VuZCIsImdldERheU9mV2VlayIsImVwb2NoIiwiRGF0ZSIsImdldERheSIsImV4dHJhY3RXZWF0aGVyRGF0YSIsImRhdGEiLCJuYW1lIiwiY2l0eSIsInN5cyIsImNvdW50cnkiLCJ3ZWF0aGVyIiwibWFpbiIsImRlc2NyaXB0aW9uIiwiaWNvbiIsIndpbmQiLCJzcGVlZCIsInRlbXAiLCJmZWVsc19saWtlIiwiZmVlbHNMaWtlIiwicHJlc3N1cmUiLCJodW1pZGl0eSIsImNvb3JkIiwibGF0IiwibG9uIiwiZGVncmVlVW5pdCIsInRoaXMiLCJ0ZW1wZXJhdHVyZSIsImZlZWxzTGlrZVRlbXAiLCJodW1pZGl0eVBlcmNlbnQiLCJ3aW5kU3BlZWRVbml0IiwicHJlc3N1cmVVbml0IiwiZXh0cmFjdE5leHREYXlzIiwibmV4dERhdGEiLCJuZXh0RGF5cyIsImN1cnJlbnREYXRlIiwic2V0RGF0ZSIsImdldERhdGUiLCJpIiwiZGF0ZVRpbWVTdHIiLCJ0b0lTT1N0cmluZyIsInNwbGl0IiwiZGF5RGF0YSIsImxpc3QiLCJmaW5kIiwiaXRlbSIsImR0X3R4dCIsInB1c2giLCJkYXkiLCJkdCIsImdldEN1cnJlbnRQb3NpdGlvbiIsInBvc2l0aW9uIiwibmF2aWdhdG9yIiwiZ2VvbG9jYXRpb24iLCJsYXRpdHVkZSIsImxvbmdpdHVkZSIsImNvb3JkcyIsImdyYWJEYXRhQnlQb3NpdGlvbiIsImVycm9yIiwiYWxlcnQiLCJhcGkiLCJyZXNwb25zZSIsImZldGNoIiwibW9kZSIsIm9rIiwiRXJyb3IiLCJqc29uIiwiZ3JhYkRhdGFCeUNpdHkiLCJzZXRUaW1lb3V0IiwicmVzIiwiZ3JhYkRhdGFOZXh0RGF5cyIsIlVJIiwic2V0VW5pdCIsInVuaXRCdG4iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJzeXN0ZW1Vbml0cyIsImRhdGFzZXQiLCJ1bml0IiwidXBkYXRlVW5pdEJ0biIsInNwYW5DIiwic3BhbkYiLCJjbGFzc0xpc3QiLCJ0b2dnbGUiLCJ0b2dnbGVVbml0IiwicmVwbGFjZVVuaXRzIiwiY29udmVydFRlbXBlcmF0dXJlIiwidGVtcE51bWJlciIsInBhcnNlRmxvYXQiLCJpbmNsdWRlcyIsInNwZWVkTnVtYmVyIiwiZm9yRWFjaCIsInNlbGVjdG9yIiwiZWxlbWVudCIsInRleHRDb250ZW50IiwiaXNXaW5kU3BlZWQiLCJsb2FkaW5nIiwic3Bpbm5lciIsInVwZGF0ZVVJIiwiY2xlYXJXZWF0aGVyIiwiZGlzcGxheVdlYXRoZXIiLCJzZXRCY2dDb2xvciIsInBpY2tDaXR5IiwidGFyZ2V0IiwiY29udGFpbnMiLCJzZWFyY2hDaXR5IiwiaW5wdXQiLCJ0cmltIiwiY2F0Y2giLCJzZXRHcmV5Q29sb3IiLCJmaW5kTWUiLCJpZCIsImRpc3BsYXlNYWluQ2FyZCIsIm1haW5DYXJkIiwiZWwiLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwiYXBwZW5kQ2hpbGQiLCJkaXNwbGF5SW1nQ2FyZCIsImltZ0NhcmQiLCJpbWciLCJzcmMiLCJhbHQiLCJkaXNwbGF5U2Vjb25kYXJ5Q2FyZCIsInNlY29uZGFyeUNhcmQiLCJkZXNjcmlwdGlvbnMiLCJkYXRhVmFsdWVzIiwiaW5kZXgiLCJwIiwic3BhbiIsImFwcGVuZCIsImNyZWF0ZUVsZW1lbnRXaXRoQ2xhc3MiLCJlbGVtZW50VHlwZSIsImNsYXNzTmFtZSIsImRpc3BsYXlDYXJkIiwiZGF5SW5kZXgiLCJjYXJkSWQiLCJjYXJkIiwiZGF5RWxlbWVudCIsInRlbXBFbGVtZW50IiwiaWNvbkVsZW1lbnQiLCJ0ZW1wU3RyIiwicGFyc2VJbnQiLCJjb2xvciIsInJhbmdlSHNsIiwiZG9jdW1lbnRFbGVtZW50Iiwic3R5bGUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJhdHRhY2hMaXN0ZW5lcnMiLCJzYW1wbGVMb2NhdGlvbnMiLCJzZWFyY2hCb3giLCJzZWFyY2hCdG4iLCJmaW5kQnRuIiwiYWRkRXZlbnRMaXN0ZW5lciIsInByZXZlbnREZWZhdWx0IiwicnVuQXBwIl0sInNvdXJjZVJvb3QiOiIifQ==